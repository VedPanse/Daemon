# DAEMON Integration

Generated by `./daemon build`.

## Files
- `DAEMON.yml`
- `daemon_entry.c`
- `daemon_runtime.c`
- `daemon_runtime.h`

## Non-destructive integration steps
1. Add `generated/daemon_runtime.c` and `generated/daemon_entry.c` to your firmware build.
2. Include `generated/daemon_runtime.h` in your firmware code.
3. Add explicit serial hooks in your firmware:
   - `read_serial_line(char *line, size_t len)` reads one newline-delimited command.
   - `write_serial_line(const char *line)` writes one newline-delimited response.
4. Initialize once at startup:
   - `daemon_runtime_init();`
5. In your main loop:
   - When a line is received from host, call `daemon_runtime_handle_line(line, now_ms);`
   - Call `daemon_runtime_tick(now_ms);` every loop for watchdog handling.
6. Publish telemetry values with:
   - `daemon_runtime_publish_telemetry("key", "value");`

## Recommended wrapper pattern
```c
void daemon_init(void) {
  daemon_runtime_init();
}

void daemon_loop(uint32_t now_ms, const char *incoming_line_or_null) {
  if (incoming_line_or_null != NULL) {
    daemon_runtime_handle_line(incoming_line_or_null, now_ms);
  }
  daemon_runtime_tick(now_ms);
}
```

## Wire Protocol
Host -> Device
- `HELLO`
- `READ_MANIFEST`
- `RUN <TOKEN> <args>`
- `STOP`

Device -> Host
- `MANIFEST <json>`
- `OK`
- `ERR <code> <message>`
- `TELEMETRY key=value ...`
